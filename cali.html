<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>California Vacation Cooking Schedule 2025</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384‚ÄëVjEe0nX1QbM1pTgZ8c9Y2gkVYF5V6c5XQzWcXcH9Kc8FJp7G/9VgZs0f+M3a6c5n"
      crossorigin="anonymous">

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap"
      rel="stylesheet">

<style>
    :root {
        --bg-gradient: linear-gradient(135deg, #0d0d1a, #1a1a33);
        --card-bg: rgba(255,255,255,.08);
        --card-bg-hover: rgba(255,255,255,.15);
        --text-primary: #f0f0f0;
        --text-muted: #b0b0c0;
        --accent: #ffcc00;
        --sidebar-bg: rgba(0,0,0,.4);
        --drag-hint: rgba(255,255,255,.2);
        --drop-success: rgba(0,200,0,.3);
    }

    body {
        font-family: 'Montserrat', sans-serif;
        background: var(--bg-gradient);
        color: var(--text-primary);
        min-height: 100vh;
        margin: 0;
    }

    h1 {font-weight:600;margin-bottom:2rem;text-align:center;color:var(--accent);}

    .wrapper {display:flex;gap:1rem;padding:1rem;}
    .sidebar {
        flex:0 0 200px;
        background:var(--sidebar-bg);
        border-radius:.5rem;
        padding:.75rem;
        max-height:calc(100vh - 4rem);
        overflow-y:auto;
    }
    .sidebar h4 {margin-top:0;color:var(--accent);text-align:center;}
    .search-box {width:100%;margin-bottom:.5rem;padding:.35rem .5rem;border:none;border-radius:.3rem;}
    .recipe-item {
        background:var(--card-bg);
        border-radius:.4rem;
        padding:.5rem .75rem;
        margin:.4rem 0;
        cursor:grab;
        user-select:none;
        font-size:.9rem;
        text-align:center;
        color:var(--text-primary);
    }
    .recipe-item:active {cursor:grabbing;}
    .recipe-item.dragging {opacity:.5;}

    .calendar {
        flex:1;
        display:grid;
        grid-template-columns:repeat(7,1fr);
        gap:.75rem;
    }
    .day-card {
        background:var(--card-bg);
        border-radius:.5rem;
        padding:.75rem;
        text-align:center;
        cursor:pointer;
        transition:background .2s,transform .2s;
        min-height:100px;
        display:flex;
        flex-direction:column;
        justify-content:center;
        color:var(--text-primary);
        position:relative;
    }
    .day-card:hover {background:var(--card-bg-hover);transform:translateY(-2px);}
    .day-card.outside-trip {opacity:.4;cursor:default;}
    .day-card .date {font-size:.9rem;color:var(--text-muted);margin-top:.25rem;}
    .day-card .assigned-recipe {
        margin-top:.4rem;
        font-size:.85rem;
        font-style:italic;
        color:var(--accent);
        position:relative;
        padding-right:1.2rem;
    }
    .day-card .clear-btn {
        position:absolute;
        top:2px;right:4px;
        color:#fff;
        cursor:pointer;
        font-weight:bold;
    }
    .day-card.drag-over {outline:2px dashed var(--accent);background:var(--drag-hint);}
    .day-card.drop-success::after{
        content:"";
        position:absolute;top:0;left:0;width:100%;height:100%;
        background:var(--drop-success);
        animation:flash 0.8s forwards;
    }
    @keyframes flash{0%{opacity:1}100%{opacity:0}}

    .instructions-card{
        background:var(--card-bg);
        border-radius:.5rem;
        padding:1.5rem;
        margin-top:2rem;
        color:var(--text-primary);
    }
    .instructions-card h2{color:var(--accent);margin-bottom:1rem;}

    .weekday-header{font-weight:600;text-align:center;color:var(--accent);margin-bottom:.5rem;}
    .weekday-header .col-1{padding:0;}

    @media (max-width:768px){
        .wrapper{flex-direction:column;}
        .sidebar{flex:0 0 auto;width:100%;max-height:none;}
        .calendar{grid-template-columns:repeat(2,1fr);}
        .offcanvas-body{padding:0;}
    }

    /* ---------- Print Styles ---------- */
    @media print{
        body{background:white;color:black;}
        .offcanvas,.btn,.search-box,.clear-btn,.weekday-header,.instructions-card{display:none!important;}
        .day-card{border:1px solid #000;background:transparent;color:black;}
        .day-card .assigned-recipe{color:black;}
        .calendar{grid-template-columns:repeat(7,1fr);}
        .print-recipes{page-break-before:always;}
        .print-recipes h2{color:#000;}
    }
</style>
</head>
<body>

<div class="container py-4">
    <h1>California Vacation Cooking Schedule 2025</h1>

    <!-- Toolbar (Export / Import / Add Recipe) -->
    <div class="d-flex flex-wrap gap-2 mb-3">
        <button class="btn btn-sm btn-outline-light" data-bs-toggle="offcanvas"
                data-bs-target="#offcanvasRecipes" aria-controls="offcanvasRecipes">
            <i class="bi bi-list"></i> Recipes
        </button>

        <button class="btn btn-sm btn-outline-light" id="exportBtn">
            <i class="bi bi-download"></i> Export
        </button>

        <button class="btn btn-sm btn-outline-light" id="importBtn">
            <i class="bi bi-upload"></i> Import
        </button>

        <button class="btn btn-sm btn-outline-light" data-bs-toggle="modal"
                data-bs-target="#addRecipeModal">
            <i class="bi bi-plus"></i> Add Recipe
        </button>

        <input type="file" id="importFile" accept=".json" style="display:none;">
    </div>

    <!-- Offcanvas ‚Äì holds the recipe palette on small screens -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasRecipes"
         aria-labelledby="offcanvasRecipesLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasRecipesLabel">Recipes</h5>
            <button type="button" class="btn-close btn-close-white"
                    data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <aside class="sidebar" id="recipePalette">
                <input type="text" class="form-control search-box" id="searchBox"
                       placeholder="Search recipes‚Ä¶">
                <!-- palette items injected by JS -->
            </aside>
        </div>
    </div>

    <!-- Main layout (sidebar visible on larger screens) -->
    <div class="wrapper">
        <!-- Sidebar for larger screens (hidden on xs via CSS) -->
        <aside class="sidebar d-none d-md-block" id="recipePaletteDesktop">
            <input type="text" class="form-control search-box" id="searchBoxDesktop"
                   placeholder="Search recipes‚Ä¶">
            <!-- items injected by JS (same function works for both containers) -->
        </aside>

        <section class="flex-grow-1">
            <!-- Weekday Header Row -->
            <div class="row weekday-header">
                <div class="col-1 text-center">Sun</div>
                <div class="col-1 text-center">Mon</div>
                <div class="col-1 text-center">Tue</div>
                <div class="col-1 text-center">Wed</div>
                <div class="col-1 text-center">Thu</div>
                <div class="col-1 text-center">Fri</div>
                <div class="col-1 text-center">Sat</div>
            </div>

            <!-- Calendar Grid -->
            <div class="calendar" id="calendar"></div>

            <!-- Instructions Panel -->
            <div class="instructions-card" id="instructions">
                <p class="text-muted">Select a day to view the recipe and cooking instructions.</p>
            </div>
        </section>
    </div>

    <!-- ---------- Add Custom Recipe Modal ---------- -->
    <div class="modal fade" id="addRecipeModal" tabindex="-1"
         aria-labelledby="addRecipeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content text-dark">
                <div class="modal-header">
                    <h5 class="modal-title" id="addRecipeModalLabel">Add Custom Recipe</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addRecipeForm">
                        <div class="mb-3">
                            <label class="form-label">Recipe Key (unique, e.g. ‚ÄúVeggie Chili‚Äù)</label>
                            <input type="text" class="form-control" id="newKey" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Title (displayed in instructions)</label>
                            <input type="text" class="form-control" id="newTitle" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Ingredients (one per line)</label>
                            <textarea class="form-control" id="newIngredients" rows="4" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Steps (one per line)</label>
                            <textarea class="form-control" id="newSteps" rows="4" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Tips (optional, one per line)</label>
                            <textarea class="form-control" id="newTips" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary"
                            data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveRecipeBtn">Save Recipe</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Printable full recipe list (hidden on screen) -->
    <div class="print-recipes d-none">
        <h2>All Recipes</h2>
        <div id="allRecipesPrint"></div>
    </div>
</div>

<!-- Bootstrap 5 JS + Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384‚ÄëENjdO4Dr2bkBIFxQpeoYz1Hk8U5g4U7f0l2J8VIZjnM7E5VQZ0ZVnY4e+1m5K5pG"
        crossorigin="anonymous"></script>

<script>
/* ==============================================================
   1Ô∏è‚É£  DATE CALCULATIONS
   ============================================================== */
const tripStart = new Date(2025, 11, 18); // Dec 18, 2025 (0‚Äëbased month)
const tripEnd   = new Date(2025, 11, 28); // Dec 28, 2025

// Calendar must start on the Sunday before the trip
const startOfWeek = new Date(tripStart);
startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay());

// End on the Saturday after the trip
const endOfWeek = new Date(tripEnd);
endOfWeek.setDate(endOfWeek.getDate() + (6 - endOfWeek.getDay()));

/* ==============================================================
   2Ô∏è‚É£  RECIPE DATA (initial set)
   ============================================================== */
let recipes = {
    "Smoked Pork Butt": {
        title: "Smoked Pork Butt (Pulled Pork)",
        ingredients: [
            "5‚Äëlb pork shoulder (bone‚Äëin or boneless)",
            "2‚ÄØTbsp kosher salt",
            "2‚ÄØTbsp brown sugar",
            "1‚ÄØTbsp paprika",
            "1‚ÄØTbsp black pepper",
            "1‚ÄØTbsp garlic powder",
            "1‚ÄØTbsp onion powder",
            "¬Ω‚ÄØTbsp cayenne (optional)",
            "Applewood or hickory wood chips"
        ],
        steps: [
            "Trim excess fat, then apply a generous dry rub (all ingredients except wood).",
            "Preheat smoker to **225‚ÄØ¬∞F** and add applewood/hickory.",
            "Place pork butt on the grill grate, fat side up.",
            "Smoke until internal temperature reaches **165‚Äë170‚ÄØ¬∞F** (‚âà‚ÄØ5‚Äë6‚ÄØh).",
            "Wrap tightly in butcher paper or foil ‚Äì this speeds the stall.",
            "Return to smoker and continue until **195‚Äë205‚ÄØ¬∞F** (‚âà‚ÄØ2‚Äë3‚ÄØh more).",
            "Remove, let rest 30‚Äë45‚ÄØmin, then shred with forks.",
            "Serve with coleslaw, pickles, and buns."
        ],
        tips: [
            "Maintain a steady **225‚ÄØ¬∞F** throughout ‚Äì use a good controller or digital smoker.",
            "A digital probe (instant‚Äëread) helps watch the stall (150‚Äë170‚ÄØ¬∞F).",
            "Applewood gives a sweet flavor; hickory adds a stronger smoke."
        ]
    },
    "Beer Brats": {
        title: "Beer‚ÄëBraised Bratwurst",
        ingredients: [
            "12 bratwurst links",
            "2‚ÄØcups lager or ale",
            "1‚ÄØlarge onion, sliced",
            "2‚ÄØTbsp butter",
            "1‚ÄØTbsp mustard seeds",
            "Olive oil",
            "Buns, sauerkraut, mustard (optional)"
        ],
        steps: [
            "In a large skillet, melt butter and saut√© onions until translucent.",
            "Add mustard seeds, then lay bratwurst in the pan.",
            "Pour beer over the brats, bring to a simmer, cover, and cook 15‚Äë20‚ÄØmin.",
            "Remove brats, increase heat, and brown them on each side (2‚Äë3‚ÄØmin).",
            "Serve on buns with onions, sauerkraut, and mustard."
        ],
        tips: [
            "Use a robust lager for a richer flavor.",
            "Don‚Äôt over‚Äëcook ‚Äì the internal temperature should hit **160‚ÄØ¬∞F**."
        ]
    },
    "Smash Burgers": {
        title: "Smash Burgers",
        ingredients: [
            "1‚ÄØlb ground beef (80/20)",
            "Salt & pepper",
            "4 burger buns",
            "Cheddar slices",
            "Pickles, lettuce, tomato, onion",
            "Butter (for buns)",
            "Oil (high‚Äësmoke‚Äëpoint)"
        ],
        steps: [
            "Form the meat into 4 loose balls (‚âà‚ÄØ4‚ÄØoz each).",
            "Heat a cast‚Äëiron skillet or griddle to **high** (‚âà‚ÄØ450‚Äë500‚ÄØ¬∞F).",
            "Place a ball, let sit 30‚ÄØs, then smash with a spatula until thin.",
            "Season with salt & pepper, cook 2‚Äë3‚ÄØmin, flip, add cheese, cook another minute.",
            "Toast buns in butter, assemble with toppings."
        ],
        tips: [
            "A thin patty creates that coveted crust ‚Äì don‚Äôt over‚Äëhandle the meat.",
            "Use a heavy spatula for an even smash."
        ]
    },
    "Smoked Brisket": {
        title: "Smoked Beef Brisket",
        ingredients: [
            "10‚Äëlb whole packer brisket (point + flat)",
            "2‚ÄØTbsp kosher salt",
            "2‚ÄØTbsp black pepper",
            "1‚ÄØTbsp garlic powder",
            "1‚ÄØTbsp onion powder",
            "Hickory or oak wood chunks",
            "Apple juice (optional for spritz)"
        ],
        steps: [
            "Trim excess fat, leaving ~¬º‚Äëinch cap.",
            "Mix salt, pepper, garlic & onion powder ‚Äì apply liberally.",
            "Pre‚Äëheat smoker to **225‚ÄØ¬∞F**, add hickory/oak.",
            "Place brisket fat‚Äëside up; smoke until internal temp hits **165‚Äë170‚ÄØ¬∞F** (‚âà‚ÄØ6‚Äë8‚ÄØh).",
            "Spritz with apple juice every hour (optional).",
            "Wrap tightly in butcher paper or foil ‚Äì this gets you through the stall.",
            "Return to smoker and cook until **195‚Äë203‚ÄØ¬∞F** (‚âà‚ÄØ2‚Äë3‚ÄØh more).",
            "Rest wrapped for 1‚Äë2‚ÄØh, then slice against the grain."
        ],
        tips: [
            "Consistent **225‚ÄØ¬∞F** is key ‚Äì fluctuations >‚ÄØ15‚ÄØ¬∞F will lengthen cook time.",
            "The stall (150‚Äë170‚ÄØ¬∞F) is normal; wrapping accelerates it.",
            "Resting lets juices redistribute for juicy slices."
        ]
    },
    "Tacos": {
        title: "Grilled Chicken & Steak Tacos",
        ingredients: [
            "1‚ÄØlb chicken breast, thinly sliced",
            "1‚ÄØlb flank steak, thinly sliced",
            "2‚ÄØTbsp olive oil",
            "1‚ÄØTbsp chili powder",
            "1‚ÄØtsp cumin",
            "1‚ÄØtsp smoked paprika",
            "Salt & pepper",
            "12 small corn tortillas",
            "Toppings: cilantro, diced onion, lime wedges, salsa, avocado"
        ],
        steps: [
            "Toss chicken and steak in oil + spices; let rest 15‚ÄØmin.",
            "Grill over high heat (‚âà‚ÄØ450‚ÄØ¬∞F) ‚Äì chicken 4‚Äë5‚ÄØmin, steak 3‚Äë4‚ÄØmin per side.",
            "Let rest 5‚ÄØmin, then slice thinly.",
            "Warm tortillas on the grill, then fill with meat and desired toppings."
        ],
        tips: [
            "Oak or hickory woods give a nice char for the steak.",
            "Slice against the grain for tender steak bites."
        ]
    }
};

/* ==============================================================
   3Ô∏è‚É£  GLOBAL STATE
   ============================================================== */
const calendarEl   = document.getElementById('calendar');
const instructions = document.getElementById('instructions');
const paletteDesktop = document.getElementById('recipePaletteDesktop');
const paletteOffcanvas = document.getElementById('recipePalette'); // same content
let assignments = {};               // {"2025-12-19":"Beer Brats"}
const STORAGE_KEY = 'vacation-cook-assignments';

/* --------------------------------------------------------------
   4Ô∏è‚É£  LOAD / SAVE ASSIGNMENTS (localStorage) ‚Äì keeps data
   -------------------------------------------------------------- */
function loadAssignments() {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (stored) {
        try {
            assignments = JSON.parse(stored);
        } catch (e) { console.error('Corrupt assignment data', e); }
    }
}
function saveAssignments() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(assignments));
}

/* --------------------------------------------------------------
   5Ô∏è‚É£  BUILD RECIPE PALETTE (draggable items)
   -------------------------------------------------------------- */
function createPaletteItem(name) {
    const div = document.createElement('div');
    div.className = 'recipe-item';
    div.textContent = name;
    div.draggable = true;
    div.dataset.recipe = name;

    // drag events -------------------------------------------------
    div.addEventListener('dragstart', ev => {
        ev.dataTransfer.setData('text/plain', name);
        ev.dataTransfer.effectAllowed = 'move';
        div.classList.add('dragging');
    });
    div.addEventListener('dragend', () => div.classList.remove('dragging'));

    return div;
}

function buildPalette() {
    // Clear existing (important for import/clear)
    paletteDesktop.innerHTML = '<input type="text" class="form-control search-box" id="searchBoxDesktop" placeholder="Search recipes‚Ä¶">';
    paletteOffcanvas.innerHTML = '<input type="text" class="form-control search-box" id="searchBox" placeholder="Search recipes‚Ä¶">';

    Object.keys(recipes).forEach(name => {
        const item = createPaletteItem(name);
        paletteDesktop.appendChild(item.cloneNode(true));
        paletteOffcanvas.appendChild(item.cloneNode(true));
    });
}

/* --------------------------------------------------------------
   6Ô∏è‚É£  SEARCH / FILTER RECIPE LIST
   -------------------------------------------------------------- */
function attachSearch(boxId, container) {
    const box = document.getElementById(boxId);
    box.addEventListener('input', () => {
        const term = box.value.trim().toLowerCase();
        const items = container.querySelectorAll('.recipe-item');
        items.forEach(it => {
            const txt = it.dataset.recipe.toLowerCase();
            it.style.display = txt.includes(term) ? '' : 'none';
        });
    });
}

/* --------------------------------------------------------------
   7Ô∏è‚É£  CALENDAR BUILD
   -------------------------------------------------------------- */
function isInTrip(date) {
    return date >= tripStart && date <= tripEnd;
}
function formatMD(date) {
    return `${date.getMonth() + 1}/${date.getDate()}`;
}
function getDefaultMeal(date) {
    const iso = date.toISOString().split('T')[0];
    if (iso === '2025-12-25') return 'Smoked Brisket';
    const meals = ['Smoked Pork Butt','Beer Brats','Smash Burgers','Tacos'];
    const offset = Math.floor((date - tripStart) / (1000*60*60*24));
    if (offset < 0 || offset > (tripEnd - tripStart)/(1000*60*60*24))
        return null;
    return meals[offset % meals.length];
}

/* Build every day card */
for (let d = new Date(startOfWeek); d <= endOfWeek; d.setDate(d.getDate() + 1)) {
    const cur = new Date(d);
    const iso = cur.toISOString();

    const card = document.createElement('div');
    card.className = 'day-card' + (isInTrip(cur) ? '' : ' outside-trip');
    card.dataset.iso = iso;

    // Header (weekday)
    const weekday = cur.toLocaleDateString('en-US', { weekday: 'short' });
    const head = document.createElement('div');
    head.textContent = weekday;
    head.style.fontWeight = '600';
    card.appendChild(head);

    // Date number
    const dateEl = document.createElement('div');
    dateEl.className = 'date';
    dateEl.textContent = formatMD(cur);
    card.appendChild(dateEl);

    // Default assignment (if any)
    if (isInTrip(cur)) {
        const def = getDefaultMeal(cur);
        if (def) {
            assignments[iso] = def;
        }
    }

    // Assigned recipe label (if present)
    if (assignments[iso]) {
        const lbl = document.createElement('div');
        lbl.className = 'assigned-recipe';
        lbl.textContent = assignments[iso];

        const clear = document.createElement('span');
        clear.className = 'clear-btn';
        clear.title = 'Remove assignment';
        clear.textContent = '√ó';
        clear.addEventListener('click', ev => {
            ev.stopPropagation();               // don‚Äôt trigger card click
            delete assignments[iso];
            saveAssignments();
            lbl.remove();                       // remove label
        });
        lbl.appendChild(clear);
        card.appendChild(lbl);
    }

    // Click ‚Üí show instructions (if recipe assigned)
    card.addEventListener('click', () => {
        const meal = assignments[card.dataset.iso];
        if (meal) displayInstructions(meal);
    });

    // Drag‚Äëover / drop handling
    card.addEventListener('dragover', ev => {
        ev.preventDefault();
        ev.dataTransfer.dropEffect = 'move';
        card.classList.add('drag-over');
    });
    card.addEventListener('dragleave', () => card.classList.remove('drag-over'));
    card.addEventListener('drop', ev => {
        ev.preventDefault();
        card.classList.remove('drag-over');

        const recipeName = ev.dataTransfer.getData('text/plain');
        if (!recipeName || !(recipeName in recipes)) return;

        // Assign / overwrite
        assignments[iso] = recipeName;
        saveAssignments();
        updateCardAssignment(card, recipeName);
        // visual flash
        card.classList.add('drop-success');
        setTimeout(() => card.classList.remove('drop-success'), 800);
    });

    calendarEl.appendChild(card);
}

/* --------------------------------------------------------------
   8Ô∏è‚É£  UPDATE CARD AFTER DROP / CLEAR
   -------------------------------------------------------------- */
function updateCardAssignment(card, recipeName) {
    // Remove any old label
    const old = card.querySelector('.assigned-recipe');
    if (old) old.remove();

    // New label
    const lbl = document.createElement('div');
    lbl.className = 'assigned-recipe';
    lbl.textContent = recipeName;

    const clear = document.createElement('span');
    clear.className = 'clear-btn';
    clear.title = 'Remove assignment';
    clear.textContent = '√ó';
    clear.addEventListener('click', ev => {
        ev.stopPropagation();
        delete assignments[card.dataset.iso];
        saveAssignments();
        lbl.remove();
    });
    lbl.appendChild(clear);
    card.appendChild(lbl);
}

/* --------------------------------------------------------------
   9Ô∏è‚É£  DISPLAY RECIPE IN INSTRUCTIONS PANEL
   -------------------------------------------------------------- */
function displayInstructions(mealName) {
    const recipe = recipes[mealName];
    if (!recipe) {
        instructions.innerHTML = `<p class="text-muted">No recipe found for "${mealName}".</p>`;
        return;
    }
    const html = `
        <h2>${recipe.title}</h2>
        <h5>Ingredients</h5>
        <ul>${recipe.ingredients.map(i => `<li>${i}</li>`).join('')}</ul>
        <h5>Steps</h5>
        <ol>${recipe.steps.map(s => `<li>${s}</li>`).join('')}</ol>
        ${recipe.tips && recipe.tips.length
            ? `<h5>Tips & Techniques</h5><ul>${recipe.tips.map(t => `<li>${t}</li>`).join('')}</ul>`
            : ''
        }
    `;
    instructions.innerHTML = html;
}

/* --------------------------------------------------------------
   üîü  EXPORT / IMPORT HANDLERS
   -------------------------------------------------------------- */
document.getElementById('exportBtn').addEventListener('click', () => {
    const dataStr = JSON.stringify(assignments, null, 2);
    const blob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'vacation-cook-assignments.json';
    a.click();
    URL.revokeObjectURL(url);
});

document.getElementById('importBtn').addEventListener('click', () => {
    document.getElementById('importFile').click();
});

document.getElementById('importFile').addEventListener('change', ev => {
    const file = ev.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
        try {
            const imported = JSON.parse(e.target.result);
            // simple validation ‚Äì keys must be ISO dates and values must be known recipes
            for (const [date, rec] of Object.entries(imported)) {
                if (rec in recipes) assignments[date] = rec;
            }
            saveAssignments();
            // Refresh calendar UI
            document.querySelectorAll('.day-card').forEach(card => {
                const iso = card.dataset.iso;
                if (assignments[iso]) {
                    updateCardAssignment(card, assignments[iso]);
                } else {
                    const old = card.querySelector('.assigned-recipe');
                    if (old) old.remove();
                }
            });
        } catch (err) {
            alert('Failed to import JSON: ' + err);
        }
    };
    reader.readAsText(file);
    // Reset input so the same file can be selected again later
    ev.target.value = '';
});

/* --------------------------------------------------------------
   1Ô∏è‚É£1Ô∏è‚É£  ADD CUSTOM RECIPE
   -------------------------------------------------------------- */
document.getElementById('saveRecipeBtn').addEventListener('click', () => {
    const key = document.getElementById('newKey').value.trim();
    const title = document.getElementById('newTitle').value.trim();
    const ingredients = document.getElementById('newIngredients').value.trim().split('\n').filter(Boolean);
    const steps = document.getElementById('newSteps').value.trim().split('\n').filter(Boolean);
    const tips = document.getElementById('newTips').value.trim().split('\n').filter(Boolean);

    if (!key || !title || !ingredients.length || !steps.length) {
        alert('Please fill in the required fields.');
        return;
    }
    if (key in recipes) {
        if (!confirm('A recipe with this key already exists. Overwrite?')) return;
    }

    recipes[key] = {title, ingredients, steps, tips};

    // Re‚Äëbuild the palette (adds the new item)
    buildPalette();

    // Close modal & reset form
    const modal = bootstrap.Modal.getInstance(document.getElementById('addRecipeModal'));
    modal.hide();
    document.getElementById('addRecipeForm').reset();
});

/* --------------------------------------------------------------
   1Ô∏è‚É£2Ô∏è‚É£  PRINT‚ÄëFRIENDLY RECIPE LIST
   -------------------------------------------------------------- */
function buildPrintRecipes() {
    const container = document.getElementById('allRecipesPrint');
    container.innerHTML = '';
    Object.entries(recipes).forEach(([key, rec]) => {
        const div = document.createElement('div');
        div.style.marginBottom = '1.5rem';
        div.innerHTML = `
            <h3>${rec.title}</h3>
            <strong>Ingredients:</strong>
            <ul>${rec.ingredients.map(i => `<li>${i}</li>`).join('')}</ul>
            <strong>Steps:</strong>
            <ol>${rec.steps.map(s => `<li>${s}</li>`).join('')}</ol>
            ${rec.tips && rec.tips.length
                ? `<strong>Tips:</strong><ul>${rec.tips.map(t => `<li>${t}</li>`).join('')}</ul>`
                : ''
            }
        `;
        container.appendChild(div);
    });
}

/* --------------------------------------------------------------
   1Ô∏è‚É£3Ô∏è‚É£  INITIALISE PAGE
   -------------------------------------------------------------- */
loadAssignments();
buildPalette();
attachSearch('searchBoxDesktop', paletteDesktop);
attachSearch('searchBox', paletteOffcanvas);
buildPrintRecipes();               // hidden div for print view

// After assignments are loaded, ensure UI reflects them
document.querySelectorAll('.day-card').forEach(card => {
    const iso = card.dataset.iso;
    if (assignments[iso]) {
        updateCardAssignment(card, assignments[iso]);
    }
});
</script>
</body>
</html>
